import{j as e,e as E,h as _,f as D,i as k}from"./index.Cz5khGiF.js";import{r as l}from"./index.C0PbZYII.js";import{s as c}from"./supabase.Bouij7RW.js";import"./_commonjsHelpers.gnU0ypJ3.js";import"./preload-helper.BlTxHScW.js";function O(){const[b,i]=l.useState(!1),[n,d]=l.useState(null),[v,u]=l.useState(!0),[f,x]=l.useState({full_name:""}),[s,g]=l.useState({current:"",new:"",confirm:""}),h=async()=>{try{const{data:{session:r},error:t}=await c.auth.getSession();if(t)throw t;if(!r){d(null),u(!1);return}const{data:{user:a},error:o}=await c.auth.getUser();if(o)throw o;if(!a){d(null),u(!1);return}d(a),x({full_name:a.user_metadata?.full_name||""})}catch(r){console.error("Error:",r),d(null)}finally{u(!1)}};l.useEffect(()=>{const r=()=>{i(!0),h()};return document.addEventListener("open-profile-modal",r),()=>document.removeEventListener("open-profile-modal",r)},[]);const w=async r=>{r.preventDefault();try{const{error:t}=await c.auth.updateUser({data:{...n.user_metadata,...f}});if(t)throw t;if(s.new&&s.new===s.confirm){const{error:a}=await c.auth.updateUser({password:s.new});if(a)throw a}i(!1)}catch(t){console.error("Error:",t),alert("Error al actualizar el perfil")}},y=r=>{const{name:t,value:a}=r.target;x(o=>({...o,[t]:a}))},m=r=>{const{name:t,value:a}=r.target;g(o=>({...o,[t]:a}))},j=async()=>{try{const{data:r,error:t}=await c.auth.signInWithOAuth({provider:"discord",options:{redirectTo:`${window.location.origin}/auth/callback`,scopes:"identify email guilds",queryParams:{prompt:"consent"}}});if(t)throw t;r?.url&&(window.location.href=r.url)}catch(r){console.error("Error al conectar con Discord:",r),alert("Error al conectar con Discord")}},N=async()=>{try{await c.auth.updateUser({data:{...n.user_metadata,discord_connected:!1,discord_id:null,discord_username:null,discord_avatar:null,avatar_url:null}}),h()}catch(r){console.error("Error al desconectar Discord:",r),alert("Error al desconectar Discord")}};if(v||!n)return null;const p=!!n.user_metadata?.discord_connected,C=n.user_metadata?.discord_username;return e.jsx(e.Fragment,{children:b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-wineblack border border-neutral-gray/50 rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl text-white font-bold",children:"Editar Perfil"}),e.jsx("button",{onClick:()=>i(!1),className:"text-neutral-gray hover:text-white transition-colors",children:e.jsx(E,{size:24})})]}),e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-neutral-gray/20 flex items-center gap-3",children:[e.jsx(_,{className:"text-redvelvet text-xl"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-semibold",children:"Cuenta de Email"}),e.jsx("div",{className:"text-neutral-gray text-sm",children:n.email})]})]}),e.jsxs("div",{className:"mb-4 p-4 rounded-lg bg-neutral-gray/20 flex items-center gap-3",children:[e.jsx(D,{className:"text-[#5865F2] text-xl"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-semibold",children:"Cuenta de Discord"}),p?e.jsxs("div",{className:"text-green-400 text-sm flex items-center gap-1",children:["Conectado como ",e.jsx("span",{className:"font-bold",children:C})]}):e.jsx("div",{className:"text-neutral-gray text-sm flex items-center gap-1",children:"No conectado"})]}),p?e.jsx("button",{type:"button",onClick:N,className:"text-red-500 font-semibold hover:underline ml-2",children:"Desconectar"}):e.jsx("button",{type:"button",onClick:j,className:"text-[#5865F2] font-semibold hover:underline ml-2",children:"Conectar"})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-white font-semibold mb-2",children:"Información del Perfil"}),e.jsx("label",{className:"block text-white mb-2",children:"Nombre Completo"}),e.jsx("input",{type:"text",name:"full_name",value:f.full_name,onChange:y,className:"w-full bg-neutral-gray/20 border border-neutral-gray/50 rounded-md px-4 py-2 text-white focus:outline-none focus:border-redvelvet"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white font-semibold mb-2",children:[e.jsx(k,{})," Cambiar Contraseña"]}),e.jsx("input",{type:"password",name:"current",value:s.current,onChange:m,placeholder:"Contraseña Actual",className:"w-full bg-neutral-gray/20 border border-neutral-gray/50 rounded-md px-4 py-2 text-white mb-2 focus:outline-none focus:border-redvelvet"}),e.jsx("input",{type:"password",name:"new",value:s.new,onChange:m,placeholder:"Nueva Contraseña",className:"w-full bg-neutral-gray/20 border border-neutral-gray/50 rounded-md px-4 py-2 text-white mb-2 focus:outline-none focus:border-redvelvet"}),e.jsx("input",{type:"password",name:"confirm",value:s.confirm,onChange:m,placeholder:"Confirmar Nueva Contraseña",className:"w-full bg-neutral-gray/20 border border-neutral-gray/50 rounded-md px-4 py-2 text-white focus:outline-none focus:border-redvelvet"})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{type:"submit",className:"w-full py-3 bg-redvelvet text-white rounded-md hover:bg-redvelvet/80 transition-colors text-lg font-bold",children:"Guardar Cambios"})})]})]})})})}export{O as default};
