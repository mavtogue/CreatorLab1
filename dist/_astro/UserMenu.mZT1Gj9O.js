import{j as e,k as y,l as j,f as x,m as v}from"./index.Cz5khGiF.js";import{r as n}from"./index.C0PbZYII.js";import{s as a}from"./supabase.Bouij7RW.js";import"./_commonjsHelpers.gnU0ypJ3.js";import"./preload-helper.BlTxHScW.js";function D(){const[c,i]=n.useState(!1),[t,l]=n.useState(null),[h,o]=n.useState(!0),m=async()=>{try{const{data:{session:r},error:s}=await a.auth.getSession();if(s)throw s;if(!r){l(null),o(!1);return}const{data:{user:d},error:u}=await a.auth.getUser();if(u)throw u;if(!d){l(null),o(!1);return}l(d)}catch(r){console.error("Error:",r),l(null)}finally{o(!1)}};n.useEffect(()=>{m()},[]);const f=async()=>{try{await a.auth.signOut(),window.location.href="/"}catch(r){console.error("Error:",r),alert("Error al cerrar sesión")}},p=async()=>{try{const{data:r,error:s}=await a.auth.signInWithOAuth({provider:"discord",options:{redirectTo:`${window.location.origin}/auth/callback`,scopes:"identify email guilds"}});if(s)throw s;r?.url&&(window.location.href=r.url)}catch(r){console.error("Error:",r),alert("Error al conectar con Discord")}},w=async()=>{try{await a.auth.updateUser({data:{...t.user_metadata,discord_id:null,discord_username:null,discord_avatar:null,discord_connected:!1,avatar_url:null}}),window.location.reload()}catch(r){console.error("Error:",r),alert("Error al desconectar Discord")}};if(h)return e.jsx("div",{className:"relative",children:e.jsx("button",{className:"flex items-center space-x-2 text-white hover:text-redvelvet transition-colors",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-neutral-gray/20 animate-pulse"})})});if(!t)return null;const g=!!t.user_metadata?.discord_connected;return e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(!c),className:"flex items-center space-x-2 text-white hover:text-redvelvet transition-colors",children:t.user_metadata?.avatar_url?e.jsx("img",{src:t.user_metadata.avatar_url,alt:"Profile",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-neutral-gray/20 flex items-center justify-center",children:e.jsx(y,{className:"text-neutral-gray"})})}),c&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-wineblack border border-neutral-gray/50 rounded-md shadow-lg py-1 z-50",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-neutral-gray/30",children:[e.jsx("p",{className:"text-white font-medium",children:t.user_metadata?.full_name||"Usuario"}),e.jsx("p",{className:"text-neutral-gray text-sm",children:t.email})]}),e.jsxs("button",{onClick:()=>{i(!1),document.dispatchEvent(new CustomEvent("open-profile-modal"))},className:"w-full px-4 py-2 text-left text-white hover:bg-neutral-gray/20 transition-colors flex items-center space-x-2",children:[e.jsx(j,{className:"text-neutral-gray"}),e.jsx("span",{children:"Editar Perfil"})]}),g?e.jsxs("button",{onClick:w,className:"w-full px-4 py-2 text-left text-white hover:bg-neutral-gray/20 transition-colors flex items-center space-x-2",children:[e.jsx(x,{className:"text-[#5865F2]"}),e.jsx("span",{children:"Desconectar Discord"})]}):e.jsxs("button",{onClick:p,className:"w-full px-4 py-2 text-left text-white hover:bg-neutral-gray/20 transition-colors flex items-center space-x-2",children:[e.jsx(x,{className:"text-[#5865F2]"}),e.jsx("span",{children:"Conectar Discord"})]}),e.jsxs("button",{onClick:f,className:"w-full px-4 py-2 text-left text-redvelvet hover:bg-neutral-gray/20 transition-colors flex items-center space-x-2",children:[e.jsx(v,{}),e.jsx("span",{children:"Cerrar Sesión"})]})]})]})}export{D as default};
